# HEPHAITOS λ² νƒ€ μ¶μ‹ κΈ°λ¥ κ²€μ λ¦¬ν¬νΈ
**κ²€μμΌ**: 2025-12-16
**κ²€μ λ²”μ„**: μ „μ²΄ μ‹μ¤ν… (COPY-LEARN-BUILD)

---

## π“ κ²€μ μ”μ•½

| μΉ΄ν…κ³ λ¦¬ | μƒνƒ | ν¬λ λ”§ ν†µν•© | λΉ„κ³  |
|---------|------|------------|------|
| ν¬λ λ”§ μ‹μ¤ν… | β… μ™„λ£ | N/A | DB μ™„λ£, RPC μ™„λ£ |
| COPY (μ…€λ½ λ―Έλ¬λ§) | π΅ λ¶€λ¶„ | β λ―Έν†µν•© | UI μ™„λ£, ν¬λ λ”§ λ―Έμ—°λ™ |
| LEARN (AI νν„°) | π΅ λ¶€λ¶„ | β λ―Έν†µν•© | API ν”λ μ΄μ¤ν™€λ” |
| LEARN (μ½”μΉ­) | π΅ λ¶€λ¶„ | β λ―Έν†µν•© | UI μ™„λ£, ν¬λ λ”§ λ―Έμ—°λ™ |
| BUILD (μ „λµ μƒμ„±) | β… μ™„λ£ | β λ―Έν†µν•© | Claude μ—°λ™ μ™„λ£ |
| BUILD (λ°±ν…μ¤νΈ) | β… μ™„λ£ | β λ―Έν†µν•© | UI + λ΅μ§ μ™„λ£ |
| κ²°μ  μ‹μ¤ν… | β… μ™„λ£ | N/A | ν† μ¤νμ΄λ¨ΌμΈ  μ™„λ£ |
| ν™λ¶ μ‹μ¤ν… | β… μ™„λ£ | N/A | P0-9 μ™„λ£ |
| Safety Net v2 | β… μ™„λ£ | N/A | P0-8 μ™„λ£ |
| Broker μ—°λ™ | π΅ λ¶€λ¶„ | N/A | UnifiedBroker μΈν„°νμ΄μ¤λ§ |

---

## π” μƒμ„Έ κ²€μ

### 1. ν¬λ λ”§ μ‹μ¤ν… β…

**λ°μ΄ν„°λ² μ΄μ¤**:
- β… `credit_wallets` ν…μ΄λΈ” (μ§€κ°‘)
- β… `credit_transactions` ν…μ΄λΈ” (κ±°λ λ‚΄μ—­)
- β… `credit_packages` ν…μ΄λΈ” (ν¨ν‚¤μ§€: starter/basic/pro/enterprise)
- β… `credit_costs` ν…μ΄λΈ” (κΈ°λ¥λ³„ λΉ„μ© μ„¤μ •)

**RPC ν•¨μ**:
- β… `create_credit_wallet_for_new_user()` - μ‹ κ· μ‚¬μ©μ μ§€κ°‘ μƒμ„±
- β… `get_credit_balance(user_id)` - μ”μ•΅ μ΅°ν
- β… `spend_credits(user_id, feature, amount)` - ν¬λ λ”§ μ†λΉ„
- β… `add_credits(user_id, amount, type)` - ν¬λ λ”§ μ¶”κ°€

**ν¬λ λ”§ κ°€κ²© μ •μ±…** (μ„¤κ³„ μ™„λ£):
```
μ…€λ½ λ―Έλ¬λ§:      0 ν¬λ λ”§ (λ¬΄λ£ μ§„μ…)
AI νν„°:         1 ν¬λ λ”§ (μ €κ°€ μ§„μ…μ )
AI μ „λµ μƒμ„±:    10 ν¬λ λ”§ (ν•µμ‹¬ μμµ)
λ°±ν…μ¤νΈ 1λ…„:     3 ν¬λ λ”§
λ°±ν…μ¤νΈ 5λ…„:    10 ν¬λ λ”§
λΌμ΄λΈ μ½”μΉ­ 30λ¶„: 20 ν¬λ λ”§ (ν”„λ¦¬λ―Έμ—„)
λΌμ΄λΈ μ½”μΉ­ 60λ¶„: 35 ν¬λ λ”§
μ‹¤μ‹κ°„ μ•λ¦Ό 1μΌ:   5 ν¬λ λ”§
```

**β οΈ λ¬Έμ μ **:
- β API μ—”λ“ν¬μΈνΈμ— ν¬λ λ”§ μ†λΉ„ λ΅μ§ λ―Έν†µν•©
- β ν”„λ΅ νΈμ—”λ“μ— ν¬λ λ”§ μ”μ•΅ ν‘μ‹ λ―Έν™•μΈ
- β ν¬λ λ”§ λ¶€μ΅± μ‹ UI μ²λ¦¬ λ―Έν™•μΈ

---

### 2. COPY κΈ°λ¥ (μ…€λ½ ν¬νΈν΄λ¦¬μ¤ λ―Έλ¬λ§) π΅

**UI μ»΄ν¬λ„νΈ**:
- β… `/dashboard/mirroring` νμ΄μ§€ μ΅΄μ¬
- β… `/dashboard/copy-trading` νμ΄μ§€ μ΅΄μ¬

**API**:
- β³ ν™•μΈ ν•„μ”

**ν¬λ λ”§ ν†µν•©**:
- β λ―Έν†µν•© (0 ν¬λ λ”§μ΄λ―€λ΅ μν–¥ μ μ)

**β οΈ λ¬Έμ μ **:
- β“ Unusual Whales API μ—°λ™ μƒνƒ λ―Έν™•μΈ
- β“ μ‹¤μ  μ…€λ½ ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„° μ—°λ™ λ―Έν™•μΈ

---

### 3. LEARN κΈ°λ¥ (AI νν„° + μ½”μΉ­) π΅

**AI νν„°**:
- β… API μ—”λ“ν¬μΈνΈ μ΅΄μ¬ (`/api/ai/tutor`)
- β ν”λ μ΄μ¤ν™€λ” μ‘λ‹µλ§ (TODO μƒνƒ)
- β ν¬λ λ”§ μ†λΉ„ λ―Έν†µν•© (1 ν¬λ λ”§)

**λΌμ΄λΈ μ½”μΉ­**:
- β… UI νμ΄μ§€ μ΅΄μ¬ (`/dashboard/coaching`)
- β… API μ—”λ“ν¬μΈνΈ μ΅΄μ¬ (`/api/coaching`)
- β ν¬λ λ”§ μ†λΉ„ λ―Έν†µν•© (20-35 ν¬λ λ”§)
- β“ μ‹¤μ‹κ°„ ν™”λ©΄ κ³µμ  κΈ°λ¥ κµ¬ν„ μƒνƒ λ―Έν™•μΈ

**β οΈ λ¬Έμ μ **:
- β AI νν„° μ‹¤μ  Claude μ—°λ™ ν•„μ”
- β μ½”μΉ­ ν¬λ λ”§ μ†λΉ„ λ΅μ§ ν•„μ (κ³ κ°€ κΈ°λ¥)

---

### 4. BUILD κΈ°λ¥ (μ „λµ λΉλ” + λ°±ν…μ¤νΈ) β…

**μ „λµ μƒμ„±**:
- β… `/api/ai/strategy` (Claude μ—°λ™ μ™„λ£)
- β… `/api/ai/generate-strategy` μ΅΄μ¬
- β… `/api/ai/moa-strategy` (MoA ν¨ν„΄)
- β… Safety Net v2 μ μ© μ™„λ£ (P0-8)
- β ν¬λ λ”§ μ†λΉ„ λ―Έν†µν•© (10 ν¬λ λ”§)

**λ°±ν…μ¤νΈ**:
- β… `/dashboard/backtest` νμ΄μ§€ μ™„λ£
- β… `/api/backtest/queue` μ—”λ“ν¬μΈνΈ
- β… λ°±ν…μ¤νΈ ν μ‹μ¤ν… DB μ™„λ£
- β ν¬λ λ”§ μ†λΉ„ λ―Έν†µν•© (3-10 ν¬λ λ”§)

**μ „λµ λΉλ”**:
- β… `/dashboard/strategy-builder` νμ΄μ§€
- β… StrategyBuilder μ»΄ν¬λ„νΈ
- β… λ“λκ·Έμ•¤λ“λ΅­ λ…Έλ“ μ‹μ¤ν…

**β οΈ λ¬Έμ μ **:
- β ν¬λ λ”§ μ†λΉ„ λ΅μ§ ν•„μ (ν•µμ‹¬ μμµ κΈ°λ¥)

---

### 5. κ²°μ /ν™λ¶ μ‹μ¤ν… β…

**ν† μ¤νμ΄λ¨ΌμΈ  μ—°λ™**:
- β… `/api/payments/create` (κ²°μ  μƒμ„±)
- β… `/api/payments/confirm` (κ²°μ  ν™•μΈ)
- β… `/api/payments/cancel` (κ²°μ  μ·¨μ†)
- β… `/api/payments/subscription` (κµ¬λ… κ΄€λ¦¬)

**ν™λ¶ μ‹μ¤ν…** (P0-9):
- β… `refund_requests` ν…μ΄λΈ”
- β… `calculate_refund` RPC (μ°¨λ“± ν™λ¶ λ΅μ§)
- β… `/api/payments/refund` (GET: κ³„μ‚°, POST: μ”μ²­)
- β… UI: RefundRequestSection μ»΄ν¬λ„νΈ

**ν¬λ λ”§ ν¨ν‚¤μ§€**:
- β… Starter: β‚©9,900 (100 ν¬λ λ”§)
- β… Basic: β‚©39,000 (500+50 ν¬λ λ”§)
- β… Pro: β‚©69,000 (1000+150 ν¬λ λ”§)
- β… Enterprise: β‚©299,000 (5000+1000 ν¬λ λ”§)

---

### 6. Safety Net v2 β…

**μ •μ±… μ‹μ¤ν…** (P0-8):
- β… `safety_events` ν…μ΄λΈ” (κ°μ‚¬ λ΅κ·Έ)
- β… `policies.ts` (μ„Ήμ…λ³„ μ •μ±…)
- β… `softener.ts` (LLM κΈ°λ° μ™„ν™”)
- β… `safety-net-v2.ts` (μ—”μ§„)

**μ μ© ν„ν™©**:
- β… `/api/ai/strategy` μ „λµ μƒμ„± μ μ©
- β“ κΈ°νƒ€ AI μ—”λ“ν¬μΈνΈ λ―Έν™•μΈ

**μ •μ±…**:
- β… BLOCK: ν¬μ μ΅°μ–Έ κΈμ§€
- β… SOFTEN: μμµ λ³΄μ¥ ν‘ν„ μ™„ν™”
- β… SOFTEN: λ§¤λ§¤ κ¶μ  μ™„ν™”
- β… SOFTEN: κ·Ήλ‹¨μ  ν‘ν„ μ™„ν™”

---

### 7. Broker μ—°λ™ π΅

**UnifiedBroker μΈν„°νμ΄μ¤**:
- β… `src/lib/broker/types.ts` νƒ€μ… μ •μ
- β… `/api/broker` μ—”λ“ν¬μΈνΈ
- β… BrokerConnectWizard UI μ™„λ£
- β… BrokerStatusBadge (P0-7 μ™„λ£)

**λΈλ΅μ»¤ λ©λ΅**:
- πΆ KIS (supported)
- π”µ Alpaca (beta)
- π΅ ν‚¤μ›€μ¦κ¶ (coming_soon)
- π΅ eBestν¬μμ¦κ¶ (coming_soon)
- π΅ λ―Έλμ—μ…‹μ¦κ¶ (coming_soon)
- π΅ Robinhood (coming_soon)
- β IB (unavailable)
- β Webull (unavailable)

**β οΈ λ¬Έμ μ **:
- β“ KIS API μ‹¤μ  μ—°λ™ κµ¬ν„ μƒνƒ λ―Έν™•μΈ
- β“ OAuth ν”λ΅μ° κµ¬ν„ μƒνƒ λ―Έν™•μΈ
- β“ μ‹¤κ±°λ μ£Όλ¬Έ μ‹¤ν–‰ κµ¬ν„ λ―Έν™•μΈ

---

## π¨ λ² νƒ€ μ¶μ‹ μ „ ν•„μ μ΅°μΉμ‚¬ν•­

### P0 (μ¶μ‹ μ „ ν•„μ)

1. **ν¬λ λ”§ μ†λΉ„ ν†µν•©** β οΈ CRITICAL
   - [ ] `/api/ai/strategy` POSTμ— `spend_credits` νΈμ¶ μ¶”κ°€ (10 ν¬λ λ”§)
   - [ ] `/api/ai/tutor` POSTμ— `spend_credits` νΈμ¶ μ¶”κ°€ (1 ν¬λ λ”§)
   - [ ] `/api/coaching` POSTμ— `spend_credits` νΈμ¶ μ¶”κ°€ (20-35 ν¬λ λ”§)
   - [ ] `/api/backtest/queue` POSTμ— `spend_credits` νΈμ¶ μ¶”κ°€ (3-10 ν¬λ λ”§)

2. **ν¬λ λ”§ μ”μ•΅ λ¶€μ΅± μ²λ¦¬**
   - [ ] API: μ”μ•΅ λ¶€μ΅± μ‹ 402 Payment Required μ‘λ‹µ
   - [ ] UI: ν¬λ λ”§ λ¶€μ΅± λ¨λ‹¬ (μ¶©μ „ μ λ„)
   - [ ] UI: λ€μ‹λ³΄λ“ ν—¤λ”μ— ν¬λ λ”§ μ”μ•΅ ν‘μ‹

3. **AI νν„° μ‹¤μ  κµ¬ν„**
   - [ ] Claude API μ—°λ™ (ν„μ¬ ν”λ μ΄μ¤ν™€λ”)
   - [ ] ν¬μ κµμ΅ λ°μ΄ν„°μ…‹ μ¤€λΉ„
   - [ ] Safety Net μ μ©

4. **Broker μ—°λ™ κ²€μ¦**
   - [ ] KIS API μ‹¤μ  μ—°λ™ ν…μ¤νΈ
   - [ ] OAuth ν”λ΅μ° ν…μ¤νΈ
   - [ ] λ¨μ μ£Όλ¬Έ ν…μ¤νΈ

### P1 (λ² νƒ€ κΈ°κ°„ μ¤‘ κ°μ„ )

1. **μ…€λ½ λ―Έλ¬λ§ λ°μ΄ν„°**
   - [ ] Unusual Whales API μ—°λ™ ν™•μΈ
   - [ ] μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ λ΅μ§ ν™•μΈ

2. **μ‹¤μ‹κ°„ μ•λ¦Ό**
   - [ ] μ•λ¦Ό μ‹μ¤ν… κµ¬ν„ ν™•μΈ
   - [ ] ν¬λ λ”§ μ†λΉ„ λ΅μ§ μ¶”κ°€

3. **κ΄€λ¦¬μ λ€μ‹λ³΄λ“**
   - [ ] ν™λ¶ μ”μ²­ μΉμΈ/κ±°λ¶€ UI
   - [ ] ν¬λ λ”§ κ±°λ λ‚΄μ—­ μ΅°ν
   - [ ] μ‚¬μ©μ ν†µκ³„ λ€μ‹λ³΄λ“

---

## π“ κ²°λ΅ 

**μ „μ²΄ μ™„μ„±λ„**: μ•½ 75%

**κ°•μ **:
- β… ν•µμ‹¬ μΈν”„λΌ μ™„λ£ (ν¬λ λ”§, κ²°μ , ν™λ¶, Safety Net)
- β… UI/UX μ™„μ„±λ„ λ†’μ (Glass Morphism λ””μμΈ)
- β… BUILD κΈ°λ¥ λ€λ¶€λ¶„ μ™„λ£ (μ „λµ μƒμ„±, λ°±ν…μ¤νΈ)
- β… λ²•λ¥  μ¤€μ μ‹μ¤ν… μ™„λ£ (Safety Net v2)

**μ•½μ **:
- β ν¬λ λ”§ μ†λΉ„ λ΅μ§ λ―Έν†µν•© (μμµν™” λ¶κ°€)
- β AI νν„° λ―Έκµ¬ν„ (LEARN κΈ°λ¥ ν•µμ‹¬)
- β Broker μ‹¤κ±°λ μ—°λ™ λ―Έν™•μΈ

**λ² νƒ€ μ¶μ‹ κ°€λ¥ μ—¬λ¶€**:
- **μ΅°κ±΄λ¶€ κ°€λ¥** - P0 ν•„μ μ΅°μΉμ‚¬ν•­ μ™„λ£ μ‹
- **μμƒ μ†μ” μ‹κ°„**: 1-2μΌ (ν¬λ λ”§ ν†µν•© + AI νν„°)

---

## π― κ¶μ¥ λ‹¤μ λ‹¨κ³„

### μ¦‰μ‹ μ°©μ (P0 μ™„λ£)
1. **ν¬λ λ”§ ν†µν•© ν—¬νΌ ν•¨μ μ‘μ„±** (`src/lib/credits/spend-helper.ts`)
2. **4κ° ν•µμ‹¬ API ν¬λ λ”§ ν†µν•©** (μ „λµ/νν„°/μ½”μΉ­/λ°±ν…μ¤νΈ)
3. **ν¬λ λ”§ μ”μ•΅ UI κµ¬ν„** (ν—¤λ” + λ¶€μ΅± λ¨λ‹¬)
4. **AI νν„° Claude μ—°λ™**

### λ² νƒ€ μ¶μ‹ ν›„ (P1 κ°μ„ )
1. Unusual Whales λ°μ΄ν„° μ—°λ™
2. μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν…
3. κ΄€λ¦¬μ λ€μ‹λ³΄λ“
4. KIS API μ‹¤κ±°λ μ—°λ™
