# ============================================
# FORGE LABS 기능 명세서
# QUERY-002: Feature Analysis
# ============================================

feature:
  id: "FEAT-2024-002"
  name: "competitor-monitor"
  app: "folio"
  priority: "P1"
  created: "2024-12-19"
  status: "analysis"

# ============================================
# 1. 문제 정의
# ============================================
problem:
  statement: |
    소상공인이 주변 경쟁업체의 가격, 메뉴, 평점 등을
    실시간으로 파악하기 어려움

  pain_points:
    - "경쟁사 정보를 일일이 검색해야 함"
    - "가격 변동을 놓쳐 경쟁력 상실"
    - "신규 경쟁사 출현을 늦게 인지"
    - "리뷰 트렌드 파악이 어려움"

  alternatives:
    - name: "수동 조사"
      weakness: "시간 소모, 불규칙"
    - name: "배달앱 직접 확인"
      weakness: "분산된 정보, 비교 어려움"
    - name: "마케팅 대행사"
      weakness: "높은 비용, 실시간성 부족"

# ============================================
# 2. 사용자 스토리
# ============================================
user_stories:
  - id: "US-001"
    as: "음식점 사장님"
    want: "주변 경쟁 음식점의 메뉴 가격을 한눈에 보고 싶다"
    so_that: "적정 가격을 책정할 수 있다"
    priority: "P0"

  - id: "US-002"
    as: "카페 운영자"
    want: "경쟁 카페의 신메뉴 출시를 알고 싶다"
    so_that: "트렌드에 뒤처지지 않을 수 있다"
    priority: "P1"

  - id: "US-003"
    as: "소상공인"
    want: "경쟁사의 평점 변화를 추적하고 싶다"
    so_that: "서비스 품질을 비교 분석할 수 있다"
    priority: "P1"

  - id: "US-004"
    as: "신규 창업자"
    want: "상권 내 경쟁 현황 리포트를 받고 싶다"
    so_that: "창업 전략을 수립할 수 있다"
    priority: "P2"

# ============================================
# 3. 수락 기준 (Acceptance Criteria)
# ============================================
acceptance_criteria:
  - id: "AC-001"
    story: "US-001"
    given: "사용자가 내 매장 위치를 등록했을 때"
    when: "경쟁사 탭을 열면"
    then: "반경 1km 내 동종업 경쟁사 목록이 표시된다"

  - id: "AC-002"
    story: "US-001"
    given: "경쟁사 목록이 있을 때"
    when: "특정 경쟁사를 선택하면"
    then: "메뉴, 가격, 평점, 리뷰 수가 표시된다"

  - id: "AC-003"
    story: "US-002"
    given: "경쟁사 모니터링이 설정되었을 때"
    when: "경쟁사가 메뉴를 추가/변경하면"
    then: "알림이 발송된다"

  - id: "AC-004"
    story: "US-004"
    given: "상권 데이터가 수집되었을 때"
    when: "리포트 생성을 요청하면"
    then: "경쟁 분석 PDF 리포트가 다운로드된다"

# ============================================
# 4. 나노인자 분해
# ============================================
nano_factors:
  L0_atoms:
    - name: "BusinessCategory"
      path: "packages/types/src/folio/category.ts"
      description: "업종 카테고리 enum"

    - name: "ICompetitor"
      path: "packages/types/src/folio/competitor.ts"
      description: "경쟁사 정보 인터페이스"

    - name: "IProduct"
      path: "packages/types/src/folio/product.ts"
      description: "상품/메뉴 인터페이스"

    - name: "ILocation"
      path: "packages/types/src/folio/location.ts"
      description: "위치 정보 인터페이스"

  L1_molecules:
    - name: "calculateDistance"
      path: "packages/utils/src/geo.ts"
      description: "두 좌표 간 거리 계산 (Haversine)"

    - name: "normalizeProduct"
      path: "packages/utils/src/product.ts"
      description: "상품 정보 정규화"

    - name: "extractPriceRange"
      path: "packages/utils/src/price.ts"
      description: "가격대 추출 유틸리티"

  L2_cells:
    - name: "PlaceCrawlerService"
      path: "packages/core/src/services/place-crawler-service.ts"
      description: "네이버/카카오 플레이스 크롤링"

    - name: "CompetitorRepository"
      path: "packages/core/src/repositories/competitor-repository.ts"
      description: "경쟁사 데이터 저장소"

  L3_tissues:
    - name: "CompetitorMonitorAgent"
      path: "apps/folio/src/agents/competitor-monitor-agent.ts"
      description: "경쟁사 모니터링 에이전트"

# ============================================
# 5. 의존성 매핑
# ============================================
dependencies:
  internal:
    - package: "@forge/types"
      reason: "L0 타입 정의"
    - package: "@forge/utils"
      reason: "거리 계산, 정규화"
    - package: "@forge/core"
      reason: "크롤러 서비스"

  external:
    - name: "Naver Place API"
      type: "REST"
      auth: "Client ID + Secret"
      docs: "https://developers.naver.com/docs/serviceapi/search/local/"

    - name: "Kakao Local API"
      type: "REST"
      auth: "REST API Key"
      docs: "https://developers.kakao.com/docs/latest/ko/local/dev-guide"

# ============================================
# 6. 리스크 평가
# ============================================
risks:
  - id: "RISK-001"
    risk: "플랫폼 크롤링 차단"
    probability: "MEDIUM"
    impact: "HIGH"
    mitigation: "공식 API 우선 사용, 요청 간격 조절"

  - id: "RISK-002"
    risk: "부정확한 위치 데이터"
    probability: "LOW"
    impact: "MEDIUM"
    mitigation: "다중 소스 교차 검증"

# ============================================
# 메타데이터
# ============================================
metadata:
  query_id: "QRY-2024-002"
  query_type: "feature-analysis"
  total_nano_factors: 10
  estimated_effort: "3일"
